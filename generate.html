<!DOCTYPE html>
<html>
<head><meta charset="utf-8"></head>
<body>
<script>
(async () => {
  // 1. 拉取原合并 JSON（含 100 笔、保持原排名顺序）
  const merged = await fetch('<https://ecictesting.github.io/hong-kong-kindergarten-guide/merged.json>').then(r => r.json());

  // 2. 拉取官中／官英 CSV
  const fetchCSV = async url => {
    const txt = await fetch(url).then(r => r.text());
    const lines = txt.split('\n');
    // 找 header 行
    const idx = lines.findIndex(l => l.includes('school_name'));
    const header = lines[idx].split('^');
    return lines.slice(idx + 1)
      .map(r => r.split('^'))
      .filter(cols => cols.length >= header.length)
      .map(cols => {
        const obj = {};
        header.forEach((h,i) => obj[h.trim()] = cols[i].trim());
        return obj;
      });
  };
  const tcRows = await fetchCSV('<http://www.edb.gov.hk/attachment/tc/edu-system/preprimary-kindergarten/free-quality-kg-edu/KGP_2024_tc.csv>');
  const enRows = await fetchCSV('<
http://www.edb.gov.hk/attachment/en/edu-system/preprimary-kindergarten/free-quality-kg-edu/KGP_2024_en.csv>');

  // 3. 建索引
  const tcMap = Object.fromEntries(tcRows.map(r => [r.school_name, r]));
  const enMap = Object.fromEntries(enRows.map(r => [r.school_name, r]));

  // 4. 更新
  const updated = merged.map(k => {
    const name = k.chineseName;
    const tc = tcMap[name] || {};
    const en = enMap[name] || {};
    return {
      id: k.id,
      chineseName: tc.school_name || k.chineseName,
      englishName: en.school_name || k.englishName,
      address: tc.address || k.address,
      website: tc.school_website || k.website,
      freeScheme: tc.free_scheme || k.freeScheme,
      district: tc.district || k.district,
      teachingLanguage: k.teachingLanguage,
      gender: k.gender,
      tuition: k.tuition,
      primarySchool: k.primarySchool,
      secondarySchool: k.secondarySchool,
      relationship: k.relationship,
      closureStatus: k.closureStatus
    };
  });

  // 5. 将结果打印到控制台，复制粘贴即可
  console.log(JSON.stringify(updated, null, 2));
})();
</script>
</body>
</html>
