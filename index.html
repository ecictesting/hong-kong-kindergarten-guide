<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>香港幼稚園排名</title>

  <!-- Tailwind CDN 固定版本 + 備援 -->
  <script src="https://cdn.tailwindcss.com/3.4.3"
          onerror="this.onerror=null;this.src='https://unpkg.com/tailwindcss@3.4.3/dist/tailwind.min.js'"></script>

  <style>
    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background-color: #f9fafb;
      margin: 0;
      padding: 1rem;
    }
    .kindergarten-card {
      cursor: pointer;
      background: white;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
      transition: box-shadow 0.3s ease, transform 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 220px;
    }
    .kindergarten-card:hover {
      box-shadow: 0 10px 15px rgb(0 0 0 / 0.15);
      transform: translateY(-5px);
    }
    .highlight-relation {
      border: 2px solid #10b981; /* Tailwind emerald-500 */
      background-color: #ecfdf5; /* Tailwind emerald-50 */
    }
    .details {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: max-height 0.4s ease, opacity 0.4s ease;
      margin-top: 0;
    }
    .details.open {
      max-height: 500px;
      opacity: 1;
      margin-top: 1rem;
    }
    .filters select {
      cursor: pointer;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      padding: 0.375rem 0.75rem;
      width: 100%;
      max-width: 200px;
      background: white;
      margin-bottom: 1rem;
    }
    h1 {
      text-align: center;
      margin-bottom: 1.5rem;
      font-weight: 700;
      font-size: 2rem;
      color: #1f2937; /* Gray-800 */
    }
    #kindergarten-list {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
      gap: 1.25rem;
    }
  </style>
</head>
<body>

  <h1>香港幼稚園排名 Top 100</h1>

  <div class="filters flex flex-wrap gap-4 justify-center mb-6">
    <select id="districtFilter" aria-label="地區篩選">
      <option value="all">所有地區</option>
    </select>
    <select id="genderFilter" aria-label="性別篩選">
      <option value="all">所有性別</option>
      <option value="男女校">男女校</option>
      <option value="男校">男校</option>
      <option value="女校">女校</option>
    </select>
    <select id="freeSchemeFilter" aria-label="免費幼稚園計劃篩選">
      <option value="all">所有免費計劃狀態</option>
      <option value="有">有參加</option>
      <option value="沒有">沒有參加</option>
      <option value="不是">不是</option>
    </select>
  </div>

  <div id="kindergarten-list" aria-live="polite" aria-relevant="additions"></div>

  <script>
    // 載入本地 merged.json，初始化
    fetch('merged.json')
      .then(response => {
        if (!response.ok) throw new Error(`讀取資料錯誤：${response.status}`);
        return response.json();
      })
      .then(data => initPage(data))
      .catch(err => {
        document.body.innerHTML = `<p class="text-red-600 text-center mt-10">資料載入失敗：${err.message}</p>`;
      });

    function initPage(kinders) {
      // 先簡化教學語言欄位供篩選用
      kinders.forEach(k => {
        k.simpleLang = simplifyLanguage(k.teachingLanguage);
      });

      // DOM 參考
      const listEl = document.getElementById('kindergarten-list');
      const districtFilter = document.getElementById('districtFilter');
      const genderFilter = document.getElementById('genderFilter');
      const freeSchemeFilter = document.getElementById('freeSchemeFilter');

      // 填充地區篩選選單
      const districts = Array.from(new Set(kinders.map(k => k.district))).sort();
      districts.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d;
        opt.textContent = d;
        districtFilter.appendChild(opt);
      });

      // 綁定篩選改變事件
      [districtFilter, genderFilter, freeSchemeFilter].forEach(el => {
        el.addEventListener('change', renderList);
      });

      // 簡單教學語言判斷
      function simplifyLanguage(lang) {
        if(!lang) return '其他';
        lang = lang.trim();
        if(lang.includes('中文') && lang.includes('英文')) {
          if(/兩文三語|普通話/.test(lang)) return '兩文三語';
          return '中英文';
        }
        if(/中文|粵語/.test(lang)) return '中文';
        if(/英文|德文/.test(lang)) return '英文';
        return '其他';
      }

      // 建立幼稚園卡片
      function createCard(k, idx) {
        const card = document.createElement('div');
        const hasRelation = k.primarySchool !== '沒有' || k.secondarySchool !== '沒有';
        card.className = 'kindergarten-card' + (hasRelation ? ' highlight-relation' : '');
        // 組基礎內容
        card.innerHTML = `
          <div>
            <h2 class="font-semibold text-lg text-blue-700 mb-1">${idx}. ${k.chineseName}</h2>
            ${k.closureStatus ? `<p class="text-red-600 font-bold">${k.closureStatus}</p>` : ''}
            <p><strong>英文名:</strong> ${k.englishName}</p>
            <p><strong>地區:</strong> ${k.district}</p>
            <p><strong>性別:</strong> ${k.gender}</p>
            <p><strong>教學語言:</strong> ${k.teachingLanguage || '待查'}</p>
            <p><strong>免費計劃:</strong> ${k.freeScheme}</p>
          </div>
          <div class="details" aria-hidden="true">
            <p><strong>學費:</strong> ${k.tuition || '待查'}</p>
            <p><strong>關聯小學:</strong> ${k.primarySchool}</p>
            <p><strong>關聯中學:</strong> ${k.secondarySchool}</p>
            <p><strong>關係:</strong> ${k.relationship || '待查'}</p>
            <p><strong>地址:</strong> ${k.address ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(k.address)}" target="_blank" rel="noopener">${k.address}</a>` : '待查'}</p>
            <p><strong>網站:</strong> ${k.website && k.website !== '待查' ? `<a href="${k.website}" target="_blank" rel="noopener">${k.website}</a>` : '待查'}</p>
          </div>
        `;

        // 點擊切換詳細內容顯示
        card.addEventListener('click', () => {
          const details = card.querySelector('.details');
          const isOpen = details.classList.contains('open');
          details.classList.toggle('open');
          details.setAttribute('aria-hidden', isOpen ? 'true' : 'false');
        });

        return card;
      }

      // 篩選條件套用並渲染清單
      function renderList() {
        const selDistrict = districtFilter.value;
        const selGender = genderFilter.value;
        const selFree = freeSchemeFilter.value;

        const filtered = kinders.filter(k => {
          return (selDistrict === 'all' || k.district === selDistrict)
              && (selGender === 'all' || k.gender === selGender)
              && (selFree === 'all' || k.freeScheme === selFree);
        });

        listEl.innerHTML = '';
        if(filtered.length === 0) {
          listEl.innerHTML = '<p class="text-center col-span-full text-gray-600">無符合條件的幼稚園</p>';
          return;
        }

        filtered.forEach((k, idx) => {
          listEl.appendChild(createCard(k, idx + 1));
        });
      }

      // 首次渲染
      renderList();
    }
  </script>

</body>
</html>
